webpackJsonp([20],{"/xAO":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("3cXf"),n=i.n(a),o=i("65Gt"),s=i.n(o),c={data:function(){return{coefficient:1,ii:0,fangdashow:!0,planx:384,plany:180.5,percentage:0,percenta:1,pagetime:"",canvas:"",context:"",speed:1,nowtimedata:"",settime:null,timei:1,playorno:!0,floorgrop:[],zongq:"",room:"",peoplefloor:[],people:[],roompeople:[{name:"---",num:"---",state:"---"},{name:"---",num:"---",state:"---"},{name:"---",num:"---",state:"---"}],x:720,y:300,floorid:""}},props:{timedata:null},created:function(){var t=this;this.$ajax.post("/mainPage/getFloorAndRoomJson").then(function(e){t.zongq=e.data;for(var i=0;i<t.zongq.length;i++)t.floorgrop=t.floorgrop.concat(t.zongq[i].loushu);t.room=t.zongq[0].loushu[0].roomqing,t.getCoefficient(t.zongq[0].loushu[0].X,t.zongq[0].loushu[0].Y),t.x=t.zongq[0].loushu[0].X,t.y=t.zongq[0].loushu[0].Y,t.floorid=t.zongq[0].loushu[0].floorId})},mounted:function(){this.canvas=document.getElementById("mycanvas"),this.context=this.canvas.getContext("2d")},destroyed:function(){clearInterval(this.settime)},watch:{timedata:function(t){},nowtimedata:function(t,e){this.planx=384-t.xmetre*this.percenta*this.coefficient,this.plany=180.5-t.ymetre*this.percenta*this.coefficient,t.floorid!=e.floorid&&(this.changefloor(t.floorid),this.playorno||this.timedata[0].id!==t.id&&(alert("即将跨越楼层，保存截图"),this.createPicture(this.nowtimedata.uploadedtime)))},percentage:function(t){this.percenta=0==t?1:t/50+1}},methods:{getCoefficient:function(t,e){this.coefficient=766/t>359/e?359/e:766/t},changefloor:function(t){var e=this;this.floorgrop.forEach(function(i){i.floorId===t&&(e.room=i.roomqing,e.floorid=i.floorId,e.x=i.X,e.y=i.Y)})},go:function(){this.fangdashow=!1,0!=this.timedata.length?(this.playorno=!1,this.godatachange(this.speed)):this.$message("请确定该时间段内目标人员是否存在数据！")},stop:function(){this.playorno=!0,clearInterval(this.settime)},addspeed:function(){var t=this;setTimeout(function(){t.playorno?t.$message("请先播放！"):t.speed>=16?(t.speed=1,t.godatachange(t.speed),t.$message("正常播放")):(t.speed=2*t.speed,t.godatachange(t.speed),t.$message("x"+t.speed+"播放"))},1e3)},godatachange:function(t){var e=this;clearInterval(this.settime),this.settime=setInterval(function(){e.ii>=e.timedata.length?(clearInterval(e.settime),e.$alert("播放已完成！","提示",{confirmButtonText:"确定"})):(e.nowtimedata=e.timedata[e.ii],0!=e.ii&&e.draw(e.timedata[e.ii-t],e.nowtimedata),e.ii=e.ii+t)},1e3)},draw:function(t,e){this.context.translate(0,this.y*this.percenta*this.coefficient),this.context.strokeStyle="red",this.context.lineWidth=3,this.context.moveTo(t.xmetre*this.percenta*this.coefficient,-t.ymetre*this.percenta*this.coefficient),this.context.lineTo(e.xmetre*this.percenta*this.coefficient,-e.ymetre*this.percenta*this.coefficient),this.context.stroke(),this.context.translate(0,-this.y*this.percenta*this.coefficient)},increase:function(){this.percentage+=10,this.percentage>100&&(this.percentage=100)},decrease:function(){this.percentage-=10,this.percentage<0&&(this.percentage=0)},createPicture:function(t){var e=this;s()(document.getElementById("jietu")).then(function(i){if(e.imgmap=i.toDataURL(),window.navigator.msSaveOrOpenBlob){for(var a=atob(e.imgmap.split(",")[1]),n=a.length,o=new Uint8Array(n);n--;)o[n]=a.charCodeAt(n);var s=new Blob([o]);window.navigator.msSaveOrOpenBlob(s,"chart-download.png")}else{var c=document.createElement("a");c.href=e.imgmap,c.setAttribute("download",t),c.click()}})}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"map",staticStyle:{position:"relative"}},[t.fangdashow?i("div",{staticClass:"kaiguanfangda"},[i("el-progress",{attrs:{percentage:t.percentage}}),t._v(" "),i("div",{staticStyle:{"margin-top":"10px","margin-right":"30px",float:"right"}},[i("el-button-group",[i("el-button",{attrs:{icon:"el-icon-minus",size:"mini"},on:{click:t.decrease}}),t._v(" "),i("el-button",{attrs:{icon:"el-icon-plus",size:"mini"},on:{click:t.increase}})],1)],1)],1):t._e(),t._v(" "),i("div",{staticClass:"time"},[t._v(t._s(t.nowtimedata.uploadedtime))]),t._v(" "),i("div",{staticClass:"shuliang"},[t._m(0),t._v(" "),t._l(t.zongq,function(e,a){return i("div",{key:a,staticClass:"fir"},t._l(e.loushu,function(a,n){return i("el-tooltip",{key:n,staticClass:"item",attrs:{effect:"dark",content:e.buildName+a.floorName,placement:"left-start"}},[i("div",{staticClass:"lil",attrs:{id:a.floorId===t.floorid?"active":"noactive"}},[i("b",{staticStyle:{color:"#03b2e1","font-size":"22px"}},[t._v(t._s(e.buildName))]),t._v(" "),i("b",{staticStyle:{"font-size":"12px"}},[t._v(t._s(a.floorName))])])])}),1)})],2),t._v(" "),i("div",{staticClass:"shichuang"},[i("i",{staticClass:"iconfont iconbuhangxiaoren peopletu"}),t._v(" "),i("div",{staticClass:"plan",style:{width:t.x*t.percenta*t.coefficient+"px",height:t.y*t.percenta*t.coefficient+"px",left:t.planx+"px",bottom:t.plany+"px"},attrs:{id:"jietu"}},[t._l(t.room,function(e,a){return i("div",{key:a,staticClass:"room",style:{background:"私人区域"==e.type?"radial-gradient(circle, #183c59, #18657f)":"公共区域"==e.type?"radial-gradient(circle, #1a494e, #1d6d6e)":"高危区域"==e.type?"radial-gradient(circle, #513841, #883652)":(e.type,"radial-gradient(circle, #ae5b1b, #65462f)"),border:"私人区域"==e.type?"1px solid #05d2d5":"公共区域"==e.type?"1px solid #1ba999":"高危区域"==e.type?"1px solid #f4464a":(e.type,"1px solid #c36218"),width:(e.rightx*t.percenta-e.leftx*t.percenta)*t.coefficient+"px",height:(e.righty*t.percenta-e.lefty*t.percenta)*t.coefficient+"px",left:e.leftx*t.percenta*t.coefficient+"px",bottom:e.lefty*t.percenta*t.coefficient+"px"},attrs:{id:e.roomId}},[i("span",{staticStyle:{color:"#f3efef","font-size":"16px"}},[t._v(t._s(e.roomName))])])}),t._v(" "),i("canvas",{attrs:{id:"mycanvas",width:t.x*t.percenta*t.coefficient,height:t.y*t.percenta*t.coefficient}})],2)]),t._v(" "),i("div",{staticStyle:{position:"absolute",top:"60px",right:"48px"}},[t.playorno?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"播放",placement:"top-start"}},[i("el-button",{attrs:{icon:"fa fa-play",circle:""},on:{click:t.go}})],1):i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"暂停",placement:"top-start"}},[i("el-button",{attrs:{icon:"fa fa-pause",circle:""},on:{click:t.stop}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"快进",placement:"top-start"}},[i("el-button",{attrs:{icon:"fa fa-fast-forward",circle:""},on:{click:t.addspeed}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"截图",placement:"top-start"}},[i("el-button",{attrs:{icon:"iconfont iconjietu",circle:""},on:{click:function(e){return t.createPicture("轨迹回放"+t.nowtimedata.uploadedtime)}}})],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("li",{staticStyle:{"font-size":"0.875rem","text-align":"center"}},[e("em",{staticStyle:{display:"block",position:"relative",left:"1.875rem",top:"3.125rem",width:"0.125rem",height:"0.875rem","background-color":"#a2a800"}}),this._v("\n      楼层展示\n    ")])}]};var l={components:{oldmap:i("C7Lr")(c,r,!1,function(t){i("p6wn")},"data-v-4007ac86",null).exports},data:function(){var t=this;return{begintime:null,endtime:null,pickerMinDate:"",pickerOptions:{onPick:function(e){var i=e.maxDate,a=e.minDate;t.pickerMinDate=a.getTime(),i&&(t.pickerMinDate="")},disabledDate:function(e){if(""!==t.pickerMinDate){var i=t.pickerMinDate+25056e5;return i>new Date&&(i=new Date),e.getTime()>i}return e.getTime()>Date.now()}},mapshow:!0,changeid:"",timedatas:"",list:{},sousuo:{id:"",name:"",sex:"",roomN:"",state:"",hasDevice:""},value1:[]}},created:function(){var t=this;(this.$route.params.id||this.$route.query.id)&&(this.changeid=void 0==this.$route.params.id?this.$route.query.id:this.$route.params.id),this.$ajax.post("/person/getPersonList","sousou="+n()(this.sousuo)).then(function(e){t.list=e.data})},methods:{nowtime:function(){return!0},getTrackPlayback:function(){var t=this;if(""==this.changeid)this.$message.warning("请选择人员");else if(null==this.begintime)this.$message.warning("请选择开始时间");else if(null==this.endtime)this.$message.warning("请选择结束时间");else{var e=this.$loading({lock:!0,text:"加载中，请稍后...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$ajax.post("/person/personHistoryTrajectory","personid="+this.changeid+"&beginDate="+this.begintime+"&endDate="+this.endtime).then(function(i){0==i.data.length&&t.$message("该时间区域无数据！"),i.data.forEach(function(t){t.uploadedtime=vm.formatTime(t.uploadedtime,"Y-M-D h:m:s")}),t.timedatas=i.data,e.close()}).catch(function(i){e.close(),t.$message("加载失败！")})}},huoqu:function(){},search:function(){var t=this;this.$ajax.post("/person/getPersonList","sousou="+n()(this.sousuo)).then(function(e){t.list=e.data})},changeids:function(t){var e=this;this.value1=[],this.timedatas=[],this.changeid=t,this.mapshow=!1,setTimeout(function(){e.mapshow=!0},100)},datatime:function(t){var e=t,i=e.getMonth()+1,a=e.getDate();return i>=1&&i<=9&&(i="0"+i),a>=0&&a<=9&&(a="0"+a),e.getFullYear()+"-"+i+"-"+a+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}}},d={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"left-suo"},[i("div",{staticClass:"v-step1"},[i("el-input",{staticStyle:{width:"180px",height:"16px","font-size":"14px","margin-right":"5px"},attrs:{size:"mini",placeholder:"搜索长者"},model:{value:t.sousuo.name,callback:function(e){t.$set(t.sousuo,"name",e)},expression:"sousuo.name"}}),t._v(" "),i("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",size:"mini"},on:{click:t.search}},[t._v("搜索")])],1),t._v(" "),i("div",[i("div",{staticClass:"choice-people v-step2"},t._l(t.list,function(e,a){return i("div",{key:a,class:e.ID===t.changeid?"active-old-list":"old-list",attrs:{id:e.ID},on:{click:function(i){return t.changeids(e.ID)}}},[i("li",[t._v(t._s(e.FULLNAME))]),t._v(" "),i("li",[t._v(t._s(e.SEX))]),t._v(" "),i("li",[t._v(t._s(e.ROOMNAME))])])}),0)])]),t._v(" "),i("div",{staticClass:"tracking-time"},[i("div",{staticClass:"v-step3"},[i("div",{staticClass:"block",staticStyle:{"margin-left":"26%","margin-top":"30px"}},[i("span",[t._v("开始时间：")]),t._v(" "),i("el-date-picker",{staticStyle:{"margin-right":"20px"},attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"请选择时间"},model:{value:t.begintime,callback:function(e){t.begintime=e},expression:"begintime"}}),t._v(" "),i("span",[t._v("结束时间：")]),t._v(" "),i("el-date-picker",{staticStyle:{"margin-right":"20px"},attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"请选择时间"},model:{value:t.endtime,callback:function(e){t.endtime=e},expression:"endtime"}}),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.getTrackPlayback}},[t._v("确定")])],1)]),t._v(" "),t.mapshow?i("oldmap",{staticClass:"v-step4",staticStyle:{"margin-left":"15%","margin-top":"3%"},attrs:{timedata:t.timedatas}}):t._e()],1)])},staticRenderFns:[]};var p=i("C7Lr")(l,d,!1,function(t){i("8vsh")},"data-v-0602ac02",null);e.default=p.exports},"8vsh":function(t,e){},p6wn:function(t,e){}});
//# sourceMappingURL=20.e80784d92af99ba5899c.js.map